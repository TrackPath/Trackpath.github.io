<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>TrackPath</title>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      


      .search {
  width: 110%;
  position: relative

}

.searchTerm {
  float: left;
  width: 90%;
  border: 3px solid #00B4CC;
  padding: 5px;
  height: 20px;
  border-radius: 5px;
  outline: none;
  color: #9DBFAF;
  font-size: 14px;
}

.searchTerm:focus{
  color: #00B4CC;
}

.currentButton {
  position: absolute;  
  right: -50px;
  width: 90px;
  height: 36px;
  border: 1px solid #00B4CC;
  background: #00B4CC;
  text-align: center;
  color: #fff;
  border-radius: 3px;
  cursor: pointer;
  font-size: 12px;
}

.searchButton {
  position: absolute;  
  right: -50px;
  width: 60px;
  height: 36px;
  border: 1px solid #00B4CC;
  background: #00B4CC;
  text-align: center;
  color: #fff;
  border-radius: 3px;
  cursor: pointer;
  font-size: 12px;
}

.wrap1{
  width: 20%;
  position: absolute;
  top: 5%;
  left: 82%;
  transform: translate(-50%, -50%);
  margin: 10px 10px 10px 10px;
}

.wrap2{
  width: 20%;
  position: absolute;
  top: 15%;
  left: 82%;
  transform: translate(-50%, -50%);
  margin: 10px 10px 10px 10px;
}

.checklist{
  width: 20%;
  position: absolute;
  top: 20%;
  left: 73%;
  margin: 10px 10px 10px 10px;
}

    </style>
  </head>
  <body>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPKSQfUFfgiu9W_w7DFhDz39vOZPvwTJ0&libraries=geometry"></script>
    <script type="text/javascript" src="http://www.geocodezip.com/scripts/v3_epoly.js"></script>

    <script>


      var map, infoWindow, or, polyline;
      polyline = new google.maps.Polyline({
            path: [],
            strokeColor: '#00ff6e',
            strokeWeight: 3
          });
      var directionsService;
      var directionsDisplay;
      var destination = null;
      var startLocation = null;
      var endLocation = null;
      var waypts = null;
      var gmarkers = [];


      var icons = new Array();
      icons["red"] = new google.maps.MarkerImage("http://www.geocodezip.com/mapIcons/marker_red.png",
      // This marker is 20 pixels wide by 34 pixels tall.
      new google.maps.Size(20, 34),
      // The origin for this image is 0,0.
      new google.maps.Point(0,0),
      // The anchor for this image is at 9,34.
      new google.maps.Point(9, 34));
function getMarkerImage(iconColor) {
   if ((typeof(iconColor)=="undefined") || (iconColor==null)) { 
      iconColor = "red"; 
   }
   if (!icons[iconColor]) {
      icons[iconColor] = new google.maps.MarkerImage("http://www.geocodezip.com/mapIcons/marker_"+ iconColor +".png",
      // This marker is 20 pixels wide by 34 pixels tall.
      new google.maps.Size(20, 34),
      // The origin for this image is 0,0.
      new google.maps.Point(0,0),
      // The anchor for this image is at 6,20.
      new google.maps.Point(9, 34));
   } 
   return icons[iconColor];

}
  // Marker sizes are expressed as a Size of X,Y
  // where the origin of the image (0,0) is located
  // in the top left of the image.
 
  // Origins, anchor positions and coordinates of the marker
  // increase in the X direction to the right and in
  // the Y direction down.

  var iconImage = new google.maps.MarkerImage('http://www.geocodezip.com/mapIcons/marker_red.png',
      // This marker is 20 pixels wide by 34 pixels tall.
      new google.maps.Size(20, 34),
      // The origin for this image is 0,0.
      new google.maps.Point(0,0),
      // The anchor for this image is at 9,34.
      new google.maps.Point(9, 34));
  var iconShadow = new google.maps.MarkerImage('http://www.google.com/mapfiles/shadow50.png',
      // The shadow image is larger in the horizontal dimension
      // while the position and offset are the same as for the main image.
      new google.maps.Size(37, 34),
      new google.maps.Point(0,0),
      new google.maps.Point(9, 34));
      // Shapes define the clickable region of the icon.
      // The type defines an HTML &lt;area&gt; element 'poly' which
      // traces out a polygon as a series of X,Y points. The final
      // coordinate closes the poly by connecting to the first
      // coordinate.
  var iconShape = {
      coord: [9,0,6,1,4,2,2,4,0,8,0,12,1,14,2,16,5,19,7,23,8,26,9,30,9,34,11,34,11,30,12,26,13,24,14,21,16,18,18,16,20,12,20,8,18,4,16,2,15,1,13,0],
      type: 'poly'
  };
var infowindow = new google.maps.InfoWindow(
  { 
    size: new google.maps.Size(150,50)
  });
    
function createMarker(latlng, label, html, color) {

    var contentString = '<b>'+label+'</b><br>'+html;
    var marker = new google.maps.Marker({
        position: latlng,
         draggable: true, 
       map: map,
        shadow: iconShadow,
        icon: getMarkerImage(color),
        shape: iconShape,
        title: label,
        zIndex: Math.round(latlng.lat()*-100000)<<5
        });
        marker.myname = label;
        gmarkers.push(marker);

    google.maps.event.addListener(marker, 'click', function() {
        infowindow.setContent(contentString); 
        infowindow.open(map,marker);
        });
        return marker;
}



      function initMap() {


         directionsService = new google.maps.DirectionsService;

         directionsDisplay = new google.maps.DirectionsRenderer({
          draggable: false,
          map: map,
          //panel: document.getElementById('directionsPanel')
        });
         map = new google.maps.Map(document.getElementById('map'), {
          zoom: 7,
          center: {lat: 41.85, lng: -87.65},
          gestureHandling: 'greedy'
        });
        infoWindow = new google.maps.InfoWindow;
        directionsDisplay.setMap(map);
        //directionsDisplay.setPanel(document.getElementById('directionsPanel'));
     

        var onClickHandlerNormal = function() {
          //polyline.setMap(null);

          or = document.getElementById('startingString').value;
          calculateAndDisplayRoute(directionsService, directionsDisplay, or);
        };
        document.getElementById('submit').addEventListener('click', onClickHandlerNormal);

        var onClickHandlerCurrent = function() {
          //polyline.setMap(null);
          document.getElementById('startingString').value = "Current Location";
              if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            or = new google.maps.LatLng(pos);
            calculateAndDisplayRoute(directionsService, directionsDisplay, or);
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
    


        };

        document.getElementById('currentLocation').addEventListener('click', onClickHandlerCurrent);

       
        
      }



      function calculateAndDisplayRoute(directionsService, directionsDisplay, or) {
          polyline.setMap(null);
          if (gmarkers) { // plug this in wherever/whenever you want to clear the map of any and all markers;
            for (i in gmarkers) {
                gmarkers[i].setMap(null);
            }
            gmarkers.length = 0;
        }
        
    
        directionsService.route({
          origin: or,
          destination: document.getElementById('endingString').value,
          travelMode: 'DRIVING'
        }, function(response, status) {
          if (status === 'OK') {


            directionsDisplay.setDirections(response);
               startLocation = new Object();
              endLocation = new Object();
               polyline = new google.maps.Polyline({
            path: [],
            strokeColor: '#00ff6e',
            strokeWeight: 3
          });


          var bounds = new google.maps.LatLngBounds();


          var legs = response.routes[0].legs;
          for (i=0;i<legs.length;i++) {
            if (i == 0) { 
              startLocation.latlng = legs[i].start_location;
              startLocation.address = legs[i].start_address;
//            startLocation.marker = createMarker(legs[i].start_location,"start",legs[i].start_address,"green");
            } else { 
              waypts[i] = new Object();
              waypts[i].latlng = legs[i].start_location;
              waypts[i].address = legs[i].start_address;
//            waypts[i].marker = createMarker(legs[i].start_location,"waypoint"+i,legs[i].start_address,"yellow");
            }
            endLocation.latlng = legs[i].end_location;
            endLocation.address = legs[i].end_address;
            var steps = legs[i].steps;
// alert("processing "+steps.length+" steps");
            for (j=0;j<steps.length;j++) {
              var nextSegment = steps[j].path;
              for (k=0;k<nextSegment.length;k++) {
                polyline.getPath().push(nextSegment[k]);
                bounds.extend(nextSegment[k]);

            }
          }
        }


         
          polyline.setMap(map);
          createMarker(GetPointAtDistance(30000,polyline),"30km","30km");
          createMarker(GetPointAtDistance(60000,polyline),"60km","60km");
          createMarker(GetPointAtDistance(90000,polyline),"90km","90km");
          createMarker(GetPointAtDistance(120000,polyline),"120km","120km");

          map.fitBounds(bounds);
          
         





      }
      else {
            window.alert('Directions request failed due to ' + status);
          }

          } 
        );
      }


      //get point at distance along a polyline:

    GetPointAtDistance = function(metres, polyline) {
    // some awkward special cases
    if (metres == 0) return polyline.getPath().getAt(0);
    if (metres < 0) return null;
    if (polyline.getPath().getLength() < 2) return null;
    var dist = 0;
    var olddist = 0;
    for (var i = 1;
      (i < polyline.getPath().getLength() && dist < metres); i++) {
      olddist = dist;
      dist += google.maps.geometry.spherical.computeDistanceBetween(
        polyline.getPath().getAt(i),
        polyline.getPath().getAt(i - 1)
      );
    }
    if (dist < metres) {
      return null;
    }
    var p1 = polyline.getPath().getAt(i - 2);
    var p2 = polyline.getPath().getAt(i - 1);
    var m = (metres - olddist) / (dist - olddist);
    return new google.maps.LatLng(p1.lat() + (p2.lat() - p1.lat()) * m, p1.lng() + (p2.lng() - p1.lng()) * m);
  }



    
      

          function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
      }



      
    
  

    </script> 
  <div id="map" style="float:left;width:70%; height:100%"></div>
    <div class="wrap1">
      <div class="search">
          <input type="text" id="startingString" class="searchTerm" placeholder="Enter starting location address">
          <button id="currentLocation" type="button" class="currentButton">Use Current Location</button>
      </div>
    </div>

    <div class="wrap2">
      <div class="search">
          <input type="text" id="endingString" class="searchTerm" placeholder="Enter destination address">
          <button id="submit" type="button" class="searchButton">Submit</button>
          <i class="fa fa-search"></i>
        </button>
      </div>
    </div> 

    <div class = "checklist" >
      <h4>Include:</h4>
      <form>
        <input type="checkbox" name="selector" value = "attractions"> Attractions <br>
        <input type="checkbox" name="selector" value = "dining"> Dining <br>
        <input type="checkbox" name="selector" value = "hotels"> Hotels <br>
        <input type="checkbox" name="selector" value = "gas"> Gas Stations <br>
        <input type="submit" value = "Go!">
      </form>
    </div>


    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPKSQfUFfgiu9W_w7DFhDz39vOZPvwTJ0&callback=initMap">
    </script>

    
</script> 
<script type="text/javascript"> 
</script> 
</script>
    
    
  </body>
</html>